### readme

forked from [easy-invoices](https://github.com/CaanDoll/easy-invoices)
sqlite3 实在装不上就用 easy-invoices 改了
需求不明确，东改西改所以有超过 70%无用代码

**注意**

1. 所有结算结果数据依赖套餐(结算规则)
2. 判断结算清单根据订单号判断唯一性
3. 结算清单和受理清单的关联为业务号码，没有判断网点
4. 导出[本月需要结算的清单数量]会导出所有未结算的清单，其中包括账期。
5. 导出[本月需要结算受理清单]会导出所有未结算的清单，不包括账期。

**操作步骤**

1. 导入礼包信息（关联副卡信息）
2. 导入受理清单
3. 添加套餐规则
4. 导入结算清单

**189api**
获取验证码
http://service.gz.189.cn/wtcommission/index.php/api/popedom/sendMes/default.shtml

### 重新统计所有数据

1. 找到所有结算信息，用户号码和结算次数
2. 循环所有受理数据，匹配用户号码，如果号码存在则更新结算次数，结束流程。 未找到执行 2.1。
   2.1 受理表未匹配到号码，从礼包（副卡）信息中匹配副卡信息，获取用户号码, 关联受理业务员号码。
   2.2 通过获取到的数据更新受理表结算次数，如果礼包表也未匹配到数据，则更新结算表信息 not_found_user=1

### 获取本月需要结算的受理清单

1. 先通过套餐获取套餐名以及结算次数
2. 通过套餐名查找受理表需结算以及需要结算的次数
3. 根据套餐周期匹配出本月需要结算的受理清单以及清单结算次数
4. 导出需要结算的清单
